<ion-header [translucent]="true" fixed-slot-placement="before">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>To do Today</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">{{ folder }}</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="categories-badges">
    <ion-badge
      class="categories-badge"
      *ngFor="let category of categories"
      [ngStyle]="getBadgeStyle(category)"
      (click)="addToCategoryFilter(category)"
    >{{ category }}</ion-badge>
  </div>

  <ion-item-divider *ngIf="categoriesFilter.length"/>

  <div class="categories-badges">
    <ion-badge
      class="categories-badge"
      *ngFor="let category of categoriesFilter"
      [ngStyle]="getBadgeStyle(category)"
      (click)="deleteFromCategoryFilter(category)"
    >
      <ion-icon name="close-outline"></ion-icon>
      {{ category }}
    </ion-badge>
  </div>

  <ion-list>
    <ion-item-sliding *ngFor="let task of tasks | filterTasks:categoriesFilter;">

      <ion-item-options side="start">
        <ion-item-option color="success">
          <ion-icon slot="icon-only" name="archive"></ion-icon>
        </ion-item-option>
      </ion-item-options>

      <ion-item [button]="true"  detail="false">
        <ion-avatar slot="start">
          <img [src]="'https://picsum.photos/80/80?random=' + task.title" alt="avatar" />
        </ion-avatar>
        <ion-label>{{ task.title }}</ion-label>
      </ion-item>

      <ion-item-options side="end">
        <ion-item-option>
          <ion-icon slot="icon-only" name="heart"></ion-icon>
        </ion-item-option>
        <ion-item-option color="danger">
          <ion-icon slot="icon-only" name="trash"></ion-icon>
        </ion-item-option>
      </ion-item-options>

    </ion-item-sliding>
  </ion-list>

  <ion-fab slot="fixed" vertical="bottom" horizontal="end">
    <ion-fab-button id="open-modal">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>

  <ion-modal #modal trigger="open-modal" [canDismiss]="canDismiss" [presentingElement]="presentingElement">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Crear tarea</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="dismissModal()">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">

        <div class="categories-badges">
          <ion-badge
            class="categories-badge"
            *ngFor="let category of categoriesForTask"
            [ngStyle]="getBadgeStyle(category)"
            (click)="deleteFromCategoryFilter(category)"
          >
            <ion-icon name="close-outline"></ion-icon>
            {{ category }}
          </ion-badge>
        </div>

        <form [formGroup]="formTask">
          <ion-item>
            <ion-label position="stacked">Titulo</ion-label>
            <ion-input formControlName="title" placeholder="Titulo de la tarea" required></ion-input>
          </ion-item>
          <ion-item>
            <ion-label position="stacked">Descripción</ion-label>
            <ion-textarea formControlName="description" placeholder="Descripción de la tarea" required></ion-textarea>
          </ion-item>
          <ion-button expand="block" (click)="createTask()" [disabled]="formTask.invalid">Save</ion-button>
        </form>

        <form >
          <ion-item>
            <ion-label position="stacked">Nueva categoría?</ion-label>
            <ion-input [formControl]="formCategory" placeholder="Categoría nueva" (input)="newCategoryOnInput()" (focusout)="newCategoryFocusOut()"></ion-input>
          </ion-item>
        </form>

        <div class="categories-badges">
          <ion-badge
            class="categories-badge"
            *ngFor="let category of categories | filter:formCategory.value"
            [ngStyle]="getBadgeStyle(category)"
            (click)="addCategoryToTask(category)"
          >
            {{ category }}
          </ion-badge>
        </div>

      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>
